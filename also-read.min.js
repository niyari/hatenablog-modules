/*
 HatenaBlog Also read (c) 2016 Pocket Systems. | MIT license | psn.hatenablog.jp/entry/also-read
 (・ω・) where to go? https://www.youtube.com/watch?v=nbeGeXgjh9Q
*/
(function(){"undefined"==typeof Htnpsne&&(window.Htnpsne={});"undefined"==typeof Htnpsne.API&&(Htnpsne.API={});Htnpsne.API.htmlTagData=document.getElementsByTagName("html")[0].dataset})();
(function(){function k(b,a){var d=[];$.ajax({dataType:"xml",url:a}).done(function(a,f,h){$(a).find("item").each(function(){0!=/^\/entry/.test(location.pathname)&&location.origin+location.pathname==$(this).find("link").text()||d.push({title:$(this).find("title").text(),link:$(this).find("link").text()})});n(b,d)}).fail(function(a,d,h){n(b,[{title:"(\u53d6\u5f97\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002\u518d\u8aad\u307f\u8fbc\u307f\u3092\u884c\u3063\u3066\u304f\u3060\u3055\u3044)",link:g}])})}
function p(b,a){var d=[];$.ajax({dataType:"jsonp",url:"http://b.hatena.ne.jp/entrylist/json",data:{sort:"count",url:a}}).done(function(a,f,h){for(f=0;f<a.length;f++)1==/\/entry\//.test(a[f].link)&&location.origin+location.pathname!=a[f].link?d.push({title:a[f].title,count:a[f].count,link:a[f].link}):console.log("\u5bfe\u8c61\u306e\u30da\u30fc\u30b8\u3092\u9664\u5916\u3057\u307e\u3057\u305f\u3002(B!)");n(b,d)}).fail(function(a,d,h){n(b,[{title:"(\u53d6\u5f97\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002\u518d\u8aad\u307f\u8fbc\u307f\u3092\u884c\u3063\u3066\u304f\u3060\u3055\u3044)",
link:g}])})}function t(){var b=[],a="body.page-entry div.entry-categories a";"touch"==document.getElementsByTagName("html")[0].dataset.device&&(a="body.page-entry div.categories a");for(var a=document.querySelectorAll(a),d=0;d<a.length;d++){var l=a[d].href.split(w+"/archive/category/")[1];"undefined"!==typeof l&&b.push(l)}m=b;b=document.querySelectorAll(".js-htnpsne-awasete-module");for(a=0;a<b.length;a++)"true"==b[a].dataset.userCss&&(u=!1),d=b[a].dataset.mode,0==m.length&&(d="Recent"),"Popular"==
d?(q(b[a],Math.random().toString(36).slice(6),"Popular"),p(b[a].dataset.targetId,g)):"Recent"==d?(q(b[a],Math.random().toString(36).slice(6),"Recent"),k(b[a].dataset.targetId,g+"/rss")):(q(b[a],Math.random().toString(36).slice(6),m[0]),k(b[a].dataset.targetId,g+"/rss/category/"+m[0])),$("#Htn-psne-Awasete-Link-"+b[a].dataset.targetId).tipsy({opacity:1,gravity:"s"});x();u&&(b=document.createElement("link"),b.href="//niyari.github.io/hatenablog-modules/css/also-read.css",b.rel="stylesheet",b.type="text/css",
document.getElementsByTagName("head")[0].appendChild(b))}function v(b){return b.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function n(b,a){var d=document.querySelectorAll('.js-htnpsne-awasete-entrys[data-target-id="'+b+'"]')[0],l=d.dataset.count,f="undefined"===typeof d.dataset.trackParameters?"":d.dataset.trackParameters,h="undefined"===typeof d.dataset.listType?"":d.dataset.listType,m="undefined"===typeof d.dataset.displayBookmark_count?
!1:d.dataset.displayBookmark_count;d.innerHTML="";0==a.length&&(a=[{link:g,title:"\u30d6\u30ed\u30b0TOP\u3078"}]);var e,c,r,k;e=a.slice();c=e.length;if(0!==c)for(;--c;)r=Math.floor(Math.random()*(c+1)),k=e[c],e[c]=e[r],e[r]=k;a=e;l>a.length?l=a.length:0==l&&(l=3);if("list"==h){h=document.createElement("ul");e="";for(c=0;c<l;c++)e+='<li><a href="'+a[c].link+f+'">'+v(a[c].title),"true"==m&&(e+='<img src="http://b.st-hatena.com/entry/image/'+a[c].link+'" class="bookmark-count">'),e+="</a></li>";h.innerHTML=
e;d.appendChild(h)}else for(c=0;c<l;c++)h=document.createElement("iframe"),h.className="embed-card embed-blogcard",h.style.display="block",h.style.width="100%",h.frameBorder=0,h.scrolling="no",h.title=a[c].title,h.src="http://hatenablog-parts.com/embed?url="+encodeURIComponent(a[c].link+f),d.appendChild(h)}function q(b,a,d){var l=document.createElement("div");l.dataset.targetId=a;b.dataset.targetId=a;var f="undefined"===typeof b.dataset.trackParameters?"":' data-track-parameters="'+b.dataset.trackParameters+
'"',h="undefined"===typeof b.dataset.listType?"":' data-list-type="'+b.dataset.listType+'"',g="undefined"===typeof b.dataset.displayBookmark_count?"":' data-display-bookmark_count="'+b.dataset.displayBookmark_count+'"',e='<button class="js-htnpsne-awasete-btn-reload" data-target-id="'+a+'"><i class="blogicon-repeat"></i></button>';"true"==b.dataset.moreBtn&&(e+='<button class="js-htnpsne-awasete-btn-readmore" data-target-id="'+a+'"><i class="blogicon-list"></i></button>');"true"==b.dataset.subscribeBtn&&
(e+='<button class="js-htnpsne-awasete-btn-subscribe" data-target-id="'+a+'"><i class="blogicon-subscribe"></i></button>');var c="";"Popular"==d?(c+='<option value="" data-command="Popular" selected>\u4eba\u6c17\u30a8\u30f3\u30c8\u30ea\u30fc</option>',d=""):c+='<option value="" data-command="Popular">\u4eba\u6c17\u30a8\u30f3\u30c8\u30ea\u30fc</option>';"Recent"==d?(c+='<option value="" data-command="Recent" selected>\u65b0\u7740\u30a8\u30f3\u30c8\u30ea\u30fc</option>',d=""):c+='<option value="" data-command="Recent">\u65b0\u7740\u30a8\u30f3\u30c8\u30ea\u30fc</option>';
for(var k=0;k<m.length;k++)c+='<option value="'+m[k]+'"',d==m[k]&&(c+=" selected"),c+=">"+v(decodeURIComponent(m[k]))+"</option>";l.innerHTML='<div class="js-htnpsne-awasete-control-outer"><span class="js-htnpsne-awasete-title">'+b.dataset.title+'</span><span class="js-htnpsne-awasete-control"><a href="http://psn.hatenablog.jp/entry/also-read" id="Htn-psne-Awasete-Link-'+a+'" original-title="\u3053\u306e\u6a5f\u80fd\u306f\u4f55\uff1f" target="_blank"><i class="blogicon-help"></i></a><select class="js-htnpsne-awasete-select" data-target-id="'+
a+'">'+c+"</select>"+e+'</span></div><div class="js-htnpsne-awasete-entrys" data-target-id="'+a+'" data-count="'+~~b.dataset.count+'"'+f+h+g+"> :) </div>";b.appendChild(l)}function x(){for(var b=document.querySelectorAll(".js-htnpsne-awasete-select"),a=0;a<b.length;a++)"true"!=b[a].dataset.listen&&(b[a].dataset.listen="true",b[a].addEventListener("change",function(){var a=this.dataset.targetId;if(""!=this.value)k(a,g+"/rss/category/"+this.value);else{var b=document.querySelectorAll('select[data-target-id="'+
a+'"]')[0];"Popular"==b[b.selectedIndex].dataset.command?p(a,g):k(a,g+"/rss")}},!1));b=document.querySelectorAll(".js-htnpsne-awasete-btn-reload");for(a=0;a<b.length;a++)"true"!=b[a].dataset.listen&&(b[a].dataset.listen="true",b[a].addEventListener("click",function(){var a=this.dataset.targetId,b=document.querySelectorAll('select[data-target-id="'+a+'"]')[0];""!=b.value?k(a,g+"/rss/category/"+document.querySelectorAll('select[data-target-id="'+a+'"]')[0].value):"Popular"==b[b.selectedIndex].dataset.command?
p(a,g):k(a,g+"/rss")},!1));b=document.querySelectorAll(".js-htnpsne-awasete-btn-readmore");for(a=0;a<b.length;a++)"true"!=b[a].dataset.listen&&(b[a].dataset.listen="true",b[a].addEventListener("click",function(){var a=this.dataset.targetId,b=document.querySelectorAll('select[data-target-id="'+a+'"]')[0],f="",f=""!=b.value?g+"/archive/category/"+document.querySelectorAll('select[data-target-id="'+a+'"]')[0].value:"Popular"==b[b.selectedIndex].dataset.command?"http://b.hatena.ne.jp/entrylist?sort=count&url="+
encodeURIComponent(g):g+"/archive";window.open(f)},!1));b=document.querySelectorAll(".js-htnpsne-awasete-btn-subscribe");for(a=0;a<b.length;a++)"true"!=b[a].dataset.listen&&(b[a].dataset.listen="true",b[a].addEventListener("click",function(){var a=this.dataset.targetId,b=document.querySelectorAll('select[data-target-id="'+a+'"]')[0],f="",f=""!=b.value?g+"/rss/category/"+document.querySelectorAll('select[data-target-id="'+a+'"]')[0].value:"Popular"==b[b.selectedIndex].dataset.command?"http://b.hatena.ne.jp/entrylist?sort=count&mode=rss&url="+
encodeURIComponent(g):g+"/feed";window.open("http://cloud.feedly.com/#subscription%2Ffeed%2F"+encodeURIComponent(f))},!1))}var g=document.getElementsByTagName("html")[0].dataset.blogsUriBase,w=document.getElementsByTagName("html")[0].dataset.blog,u=!0,m=[];"uninitialized"==document.readyState||"loading"==document.readyState?window.addEventListener("DOMContentLoaded",function(){t()},!1):t()})();