/*
 HatenaBlog Also read (c) 2016 Pocket Systems. | MIT | psn.hatenablog.jp/entry/also-read
 (・ω・) where to go? https://www.youtube.com/watch?v=nbeGeXgjh9Q
*/
(function(){"undefined"==typeof Htnpsne&&(window.Htnpsne={});"undefined"==typeof Htnpsne.API&&(Htnpsne.API={});Htnpsne.API.htmlTagData=document.getElementsByTagName("html")[0].dataset})();
(function(){function l(b,a){var c=[];$.ajax({dataType:"xml",url:a}).done(function(a,d,e){$(a).find("item").each(function(){0!=/^\/entry/.test(location.pathname)&&location.origin+location.pathname==$(this).find("link").text()||c.push({title:$(this).find("title").text(),link:$(this).find("link").text()})});p(b,c)}).fail(function(a,c,e){p(b,[{title:"(\u53d6\u5f97\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002\u518d\u8aad\u307f\u8fbc\u307f\u3092\u884c\u3063\u3066\u304f\u3060\u3055\u3044)",link:d}])})}
function q(b,a){var c=[];$.ajax({dataType:"jsonp",url:"http://b.hatena.ne.jp/entrylist/json",data:{sort:"count",url:a}}).done(function(a,d,e){for(d=0;d<a.length;d++)1==/\/entry\//.test(a[d].link)&&location.origin+location.pathname!=a[d].link?c.push({title:a[d].title,count:a[d].count,link:a[d].link}):console.log("\u5bfe\u8c61\u306e\u30da\u30fc\u30b8\u3092\u9664\u5916\u3057\u307e\u3057\u305f\u3002(B!)");p(b,c)}).fail(function(a,c,e){p(b,[{title:"(\u53d6\u5f97\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002\u518d\u8aad\u307f\u8fbc\u307f\u3092\u884c\u3063\u3066\u304f\u3060\u3055\u3044)",
link:d}])})}function u(){for(var b=[],a=document.querySelectorAll("body.page-entry div.categories a"),c=0;c<a.length;c++){var f=a[c].href.split(x+"/archive/category/")[1];"undefined"!==typeof f&&b.push(f)}k=b;b=document.querySelectorAll(".js-htnpsne-awasete-module");for(a=0;a<b.length;a++)"true"==b[a].dataset.userCss&&(v=!1),c=b[a].dataset.mode,0==k.length?c=r(["Recent","Popular"])[0]:k=r(k),"Popular"==c?(t(b[a],Math.random().toString(36).slice(6),"Popular"),q(b[a].dataset.targetId,d)):"Recent"==
c?(t(b[a],Math.random().toString(36).slice(6),"Recent"),l(b[a].dataset.targetId,d+"/rss")):(t(b[a],Math.random().toString(36).slice(6),k[0]),l(b[a].dataset.targetId,d+"/rss/category/"+k[0])),$("#Htn-psne-Awasete-Link-"+b[a].dataset.targetId).tipsy({opacity:1,gravity:"s"});y();v&&(b=document.createElement("link"),b.href="//niyari.github.io/hatenablog-modules/css/also-read.css",b.rel="stylesheet",b.type="text/css",document.getElementsByTagName("head")[0].appendChild(b));"about"===Htnpsne.API.htmlTagData.page&&
(null==document.getElementById("Htnpsne-about-elem")&&(b=document.querySelector("div.entry-content dl"),a=document.createElement("dt"),a.innerText="\u30d6\u30ed\u30b0\u62e1\u5f35\u6a5f\u80fd",b.appendChild(a),a=document.createElement("dd"),a.id="Htnpsne-about-elem",b.appendChild(a)),b=document.getElementById("Htnpsne-about-elem"),a=document.createElement("div"),a.innerHTML='<a href="http://psn.hatenablog.jp/entry/also-read" target="_blank">Also read(\u306f\u3066\u306a\u30d6\u30ed\u30b0 \u3042\u308f\u305b\u3066\u8aad\u307f\u305f\u3044) \u3092\u5229\u7528\u4e2d\u3067\u3059\u3002</a>',
b.appendChild(a))}function r(b){var a,c,f;b=b.slice();a=b.length;if(0===a)return b;for(;--a;)c=Math.floor(Math.random()*(a+1)),f=b[a],b[a]=b[c],b[c]=f;return b}function w(b){return b.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function p(b,a){var c=document.querySelector('.js-htnpsne-awasete-entrys[data-target-id="'+b+'"]'),f=c.dataset.count,k="undefined"===typeof c.dataset.trackParameters?"":c.dataset.trackParameters,e="undefined"===
typeof c.dataset.listType?"":c.dataset.listType,l="undefined"===typeof c.dataset.displayBookmark_count?!1:c.dataset.displayBookmark_count;c.innerHTML="";0==a.length&&(a=[{link:d,title:"\u30d6\u30ed\u30b0TOP\u3078"}]);a=r(a);f>a.length?f=a.length:0==f&&(f=3);if("list"==e){for(var e=document.createElement("ul"),m="",g=0;g<f;g++)m+='<li><a href="'+a[g].link+k+'">'+w(a[g].title),"true"==l&&(m+='<img src="http://b.st-hatena.com/entry/image/'+a[g].link+'" class="bookmark-count">'),m+="</a></li>";e.innerHTML=
m;c.appendChild(e)}else for(g=0;g<f;g++)e=document.createElement("iframe"),e.className="embed-card embed-blogcard",e.style.display="block",e.style.width="100%",e.frameBorder=0,e.scrolling="no",e.title=a[g].title,e.src="http://hatenablog-parts.com/embed?url="+encodeURIComponent(a[g].link+k),c.appendChild(e)}function t(b,a,c){var f=document.createElement("div");f.dataset.targetId=a;b.dataset.targetId=a;var d="undefined"===typeof b.dataset.trackParameters?"":' data-track-parameters="'+b.dataset.trackParameters+
'"',e="undefined"===typeof b.dataset.listType?"":' data-list-type="'+b.dataset.listType+'"',l="undefined"===typeof b.dataset.displayBookmark_count?"":' data-display-bookmark_count="'+b.dataset.displayBookmark_count+'"',m="undefined"===typeof b.dataset.title||""==b.dataset.title?"\u3042\u308f\u305b\u3066\u8aad\u307f\u305f\u3044":b.dataset.title,g='<button class="js-htnpsne-awasete-btn-reload" data-target-id="'+a+'"><i class="blogicon-repeat"></i><span></span></button>';"true"==b.dataset.moreBtn&&(g+=
'<button class="js-htnpsne-awasete-btn-readmore" data-target-id="'+a+'"><i class="blogicon-list"></i><span></span></button>');"true"==b.dataset.subscribeBtn&&(g+='<button class="js-htnpsne-awasete-btn-subscribe" data-target-id="'+a+'"><i class="blogicon-subscribe"></i><span></span></button>');var h="";"Popular"==c?(h+='<option value="" data-command="Popular" selected>\u4eba\u6c17\u30a8\u30f3\u30c8\u30ea\u30fc</option>',c=""):h+='<option value="" data-command="Popular">\u4eba\u6c17\u30a8\u30f3\u30c8\u30ea\u30fc</option>';
"Recent"==c?(h+='<option value="" data-command="Recent" selected>\u65b0\u7740\u30a8\u30f3\u30c8\u30ea\u30fc</option>',c=""):h+='<option value="" data-command="Recent">\u65b0\u7740\u30a8\u30f3\u30c8\u30ea\u30fc</option>';for(var n=0;n<k.length;n++)h+='<option value="'+k[n]+'"',c==k[n]&&(h+=" selected"),h+=">"+w(decodeURIComponent(k[n]))+"</option>";f.innerHTML='<aside><h1 class="js-htnpsne-awasete-control-outer"><span class="js-htnpsne-awasete-title">'+m+'</span><span class="js-htnpsne-awasete-control"><a href="http://psn.hatenablog.jp/entry/also-read" id="Htn-psne-Awasete-Link-'+
a+'" original-title="\u3053\u306e\u6a5f\u80fd\u306f\u4f55\uff1f" target="_blank"><i class="blogicon-help"></i></a><select class="js-htnpsne-awasete-select" data-target-id="'+a+'">'+h+"</select>"+g+'</span></h1><div class="js-htnpsne-awasete-entrys" data-target-id="'+a+'" data-count="'+Math.abs(1*b.dataset.count)+'"'+d+e+l+"> :) </div></aside>";b.appendChild(f)}function y(){for(var b=document.querySelectorAll(".js-htnpsne-awasete-select"),a=0;a<b.length;a++)"true"!=b[a].dataset.listen&&(b[a].dataset.listen=
"true",b[a].addEventListener("change",function(){var a=this.dataset.targetId;if(""!=this.value)l(a,d+"/rss/category/"+this.value);else{var b=document.querySelector('select[data-target-id="'+a+'"]');"Popular"==b[b.selectedIndex].dataset.command?q(a,d):l(a,d+"/rss")}},!1));b=document.querySelectorAll(".js-htnpsne-awasete-btn-reload");for(a=0;a<b.length;a++)"true"!=b[a].dataset.listen&&(b[a].dataset.listen="true",b[a].addEventListener("click",function(){var a=this.dataset.targetId,b=document.querySelector('select[data-target-id="'+
a+'"]');""!=b.value?l(a,d+"/rss/category/"+b.value):"Popular"==b[b.selectedIndex].dataset.command?q(a,d):l(a,d+"/rss")},!1));b=document.querySelectorAll(".js-htnpsne-awasete-btn-readmore");for(a=0;a<b.length;a++)"true"!=b[a].dataset.listen&&(b[a].dataset.listen="true",b[a].addEventListener("click",function(){var a=document.querySelector('select[data-target-id="'+this.dataset.targetId+'"]'),b="",b=""!=a.value?d+"/archive/category/"+a.value:"Popular"==a[a.selectedIndex].dataset.command?"http://b.hatena.ne.jp/entrylist?sort=count&url="+
encodeURIComponent(d):d+"/archive";window.open(b)},!1));b=document.querySelectorAll(".js-htnpsne-awasete-btn-subscribe");for(a=0;a<b.length;a++)"true"!=b[a].dataset.listen&&(b[a].dataset.listen="true",b[a].addEventListener("click",function(){var a=document.querySelector('select[data-target-id="'+this.dataset.targetId+'"]'),b="",b=""!=a.value?d+"/rss/category/"+a.value:"Popular"==a[a.selectedIndex].dataset.command?"http://b.hatena.ne.jp/entrylist?sort=count&mode=rss&url="+encodeURIComponent(d):d+"/feed";
window.open("http://cloud.feedly.com/#subscription%2Ffeed%2F"+encodeURIComponent(b))},!1))}var d=Htnpsne.API.htmlTagData.blogsUriBase,x=Htnpsne.API.htmlTagData.blog,v=!0,k=[];"uninitialized"==document.readyState||"loading"==document.readyState?window.addEventListener("DOMContentLoaded",function(){u()},!1):u()})();