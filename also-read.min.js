/*
 HatenaBlog Also read (c) 2015 Pocket Systems. | psn.hatenablog.jp
 (・ω・) where to go? https://www.youtube.com/watch?v=nbeGeXgjh9Q
*/
(function(){function m(b,a){var d=[];$.ajax({dataType:"xml",url:a}).done(function(a,c,e){$(a).find("item").each(function(){d.push({title:$(this).find("title").text(),link:$(this).find("link").text()})});n(b,d)}).fail(function(a,b,d){})}function p(b,a){$.ajax({dataType:"jsonp",url:"http://b.hatena.ne.jp/entrylist/json",data:{sort:"count",url:a}}).done(function(a,f,c){n(b,a)}).fail(function(a,b,c){})}function q(){for(var b=[],a=document.querySelectorAll("body.page-entry div.entry-categories a"),d=0;d<
a.length;d++){var f=a[d].href.split(t+"/archive/category/")[1];"undefined"!==typeof f&&b.push(f)}l=b;b=document.querySelectorAll(".js-htnpsne-awasete-module");for(a=0;a<b.length;a++){"true"==b[a].dataset.userCss&&(r=!1);var d=b[a],f=Math.random().toString(36).slice(6),c=document.createElement("div");c.dataset.targetId=f;d.dataset.targetId=f;var e="";"true"==d.dataset.moreBtn&&(e+='<button class="js-htnpsne-awasete-btn-category" data-target-id="'+f+'">\u3082\u3063\u3068\u898b\u308b</button>');"true"==
d.dataset.subscribeBtn&&(e+='<button class="js-htnpsne-awasete-btn-subscribe" data-target-id="'+f+'">\u8cfc\u8aad\u3059\u308b</button>');for(var h='<option value="" data-command="Popular">\u4eba\u6c17\u306e\u8a18\u4e8b</option><option value="" data-command="NewEntry">\u65b0\u7740\u306e\u8a18\u4e8b</option>',k=0;k<l.length;k++)h+='<option value="'+l[k]+'">'+decodeURIComponent(l[k])+"</option>";c.innerHTML='<div class="js-htnpsne-awasete-control-outer"><span class="js-htnpsne-awasete-title">'+d.dataset.title+
'</span><span class="js-htnpsne-awasete-control"><select class="js-htnpsne-awasete-select" data-target-id="'+f+'">'+h+"</select>"+e+'<a href="http://psn.hatenablog.jp/" style="tipsy-top" id="Htn-psne-Awasete-Link-'+f+'" original-title="\u3059\u306a\u3070\u3044\u3058\u308a\u306b\u30a2\u30af\u30bb\u30b9" target="_blank">:)</a></span></div><div class="js-htnpsne-awasete-entrys" data-target-id="'+f+'" data-count="'+~~d.dataset.count+'"> :) </div>';d.appendChild(c);d=b[a].dataset.mode;0==l.length&&(d=
"Entry");"Popular"==d?p(b[a].dataset.targetId,g):"Entry"==d?m(b[a].dataset.targetId,g+"/rss"):n(b[a].dataset.targetId,"Category",l[0]);$("#Htn-psne-Awasete-Link-"+b[a].dataset.targetId).tipsy({opacity:1})}u();r&&(b=document.createElement("link"),b.href="//niyari.github.io/hatenablog-modules/css/also-read.css",b.rel="stylesheet",b.type="text/css",document.getElementsByTagName("head")[0].appendChild(b))}function n(b,a){var d=document.querySelectorAll('.js-htnpsne-awasete-entrys[data-target-id="'+b+'"]')[0],
f=d.dataset.count;d.innerHTML="";0==a.length&&(a=[{link:g,title:"\u30d6\u30ed\u30b0TOP\u3078"}]);var c,e,h,k;c=a.slice();e=c.length;if(0!==e)for(;--e;)h=Math.floor(Math.random()*(e+1)),k=c[e],c[e]=c[h],c[h]=k;a=c;f>a.length?f=a.length:0==f&&(f=3);for(c=0;c<f;c++)e=document.createElement("iframe"),e.className="embed-card embed-blogcard",e.style.display="block",e.style.width="100%",e.frameBorder=0,e.scrolling="no",e.title=a[c].title,e.src="http://hatenablog-parts.com/embed?url="+a[c].link,d.appendChild(e)}
function u(){for(var b=document.querySelectorAll(".js-htnpsne-awasete-select"),a=0;a<b.length;a++)"true"!=b[a].dataset.listen&&(b[a].dataset.listen="true",b[a].addEventListener("change",function(){var a=this.dataset.targetId;if(""!=this.value)m(a,g+"/rss/category/"+this.value);else{var b=document.querySelectorAll('select[data-target-id="'+a+'"]')[0];"Popular"==b[b.selectedIndex].dataset.command?p(a,g):m(a,g+"/rss")}},!1));b=document.querySelectorAll(".js-htnpsne-awasete-btn-category");for(a=0;a<b.length;a++)"true"!=
b[a].dataset.listen&&(b[a].dataset.listen="true",b[a].addEventListener("click",function(){var a=this.dataset.targetId,b=document.querySelectorAll('select[data-target-id="'+a+'"]')[0],c="",c=""!=b.value?g+"/archive/category/"+document.querySelectorAll('select[data-target-id="'+a+'"]')[0].value:"Popular"==b[b.selectedIndex].dataset.command?"http://b.hatena.ne.jp/entrylist?sort=count&url="+encodeURIComponent(g):g+"/archive";window.open(c)},!1));b=document.querySelectorAll(".js-htnpsne-awasete-btn-subscribe");
for(a=0;a<b.length;a++)"true"!=b[a].dataset.listen&&(b[a].dataset.listen="true",b[a].addEventListener("click",function(){var a=this.dataset.targetId,b=document.querySelectorAll('select[data-target-id="'+a+'"]')[0],c="",c=""!=b.value?g+"/rss/category/"+document.querySelectorAll('select[data-target-id="'+a+'"]')[0].value:"Popular"==b[b.selectedIndex].dataset.command?"http://b.hatena.ne.jp/entrylist?sort=count&mode=rss&url="+encodeURIComponent(g):g+"/feed",a="http://cloud.feedly.com/#subscription%2Ffeed%2F"+
encodeURIComponent(c);window.open(a)},!1))}var g=document.getElementsByTagName("html")[0].dataset.blogsUriBase,t=document.getElementsByTagName("html")[0].dataset.blog,r=!0,l=[];"uninitialized"==document.readyState||"loading"==document.readyState?window.addEventListener("DOMContentLoaded",function(){q()},!1):q()})();