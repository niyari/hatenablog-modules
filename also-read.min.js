/*
 HatenaBlog Also read (c) 2016 Pocket Systems. | MIT license | psn.hatenablog.jp/entry/also-read
 (・ω・) where to go? https://www.youtube.com/watch?v=nbeGeXgjh9Q
*/
(function(){function g(b,a){var d=[];$.ajax({dataType:"xml",url:a}).done(function(a,e,h){$(a).find("item").each(function(){d.push({title:$(this).find("title").text(),link:$(this).find("link").text()})});n(b,d)}).fail(function(a,d,h){n(b,[{title:"(\u53d6\u5f97\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002\u518d\u8aad\u307f\u8fbc\u307f\u3092\u884c\u3063\u3066\u304f\u3060\u3055\u3044)",link:e}])})}function q(b,a){$.ajax({dataType:"jsonp",url:"http://b.hatena.ne.jp/entrylist/json",data:{sort:"count",
url:a}}).done(function(a,k,e){n(b,a)}).fail(function(a,k,p){n(b,[{title:"(\u53d6\u5f97\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002\u518d\u8aad\u307f\u8fbc\u307f\u3092\u884c\u3063\u3066\u304f\u3060\u3055\u3044)",link:e}])})}function t(){var b=[],a="body.page-entry div.entry-categories a";"touch"==document.getElementsByTagName("html")[0].dataset.device&&(a="body.page-entry header.entry-header div.categories a");for(var a=document.querySelectorAll(a),d=0;d<a.length;d++){var k=a[d].href.split(w+
"/archive/category/")[1];"undefined"!==typeof k&&b.push(k)}l=b;b=document.querySelectorAll(".js-htnpsne-awasete-module");for(a=0;a<b.length;a++)"true"==b[a].dataset.userCss&&(u=!1),d=b[a].dataset.mode,0==l.length&&(d="Recent"),"Popular"==d?(r(b[a],Math.random().toString(36).slice(6),"Popular"),q(b[a].dataset.targetId,e)):"Recent"==d?(r(b[a],Math.random().toString(36).slice(6),"Recent"),g(b[a].dataset.targetId,e+"/rss")):(r(b[a],Math.random().toString(36).slice(6),l[0]),g(b[a].dataset.targetId,e+"/rss/category/"+
l[0])),$("#Htn-psne-Awasete-Link-"+b[a].dataset.targetId).tipsy({opacity:1});x();u&&(b=document.createElement("link"),b.href="//niyari.github.io/hatenablog-modules/css/also-read.css",b.rel="stylesheet",b.type="text/css",document.getElementsByTagName("head")[0].appendChild(b))}function v(b){return b.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function n(b,a){var d=document.querySelectorAll('.js-htnpsne-awasete-entrys[data-target-id="'+
b+'"]')[0],k=d.dataset.count,p="undefined"===typeof d.dataset.trackParameters?"":d.dataset.trackParameters,h="undefined"===typeof d.dataset.listType?"":d.dataset.listType,l="undefined"===typeof d.dataset.displayBookmark_count?!1:d.dataset.displayBookmark_count;d.innerHTML="";0==a.length&&(a=[{link:e,title:"\u30d6\u30ed\u30b0TOP\u3078"}]);var f,c,m,g;f=a.slice();c=f.length;if(0!==c)for(;--c;)m=Math.floor(Math.random()*(c+1)),g=f[c],f[c]=f[m],f[m]=g;a=f;k>a.length?k=a.length:0==k&&(k=3);if("list"==
h){h=document.createElement("ul");f="";for(c=0;c<k;c++)f+='<li><a href="'+a[c].link+p+'">'+v(a[c].title),"true"==l&&(f+='<img src="http://b.st-hatena.com/entry/image/'+a[c].link+'" class="bookmark-count">'),f+="</a></li>";h.innerHTML=f;d.appendChild(h)}else for(c=0;c<k;c++)h=document.createElement("iframe"),h.className="embed-card embed-blogcard",h.style.display="block",h.style.width="100%",h.frameBorder=0,h.scrolling="no",h.title=a[c].title,h.src="http://hatenablog-parts.com/embed?url="+encodeURIComponent(a[c].link+
p),d.appendChild(h)}function r(b,a,d){var k=document.createElement("div");k.dataset.targetId=a;b.dataset.targetId=a;var e="undefined"===typeof b.dataset.trackParameters?"":' data-track-parameters="'+b.dataset.trackParameters+'"',h="undefined"===typeof b.dataset.listType?"":' data-list-type="'+b.dataset.listType+'"',g="undefined"===typeof b.dataset.displayBookmark_count?"":' data-display-bookmark_count="'+b.dataset.displayBookmark_count+'"',f='<button class="js-htnpsne-awasete-btn-reload" data-target-id="'+
a+'"><i class="blogicon-repeat"></i></button>';"true"==b.dataset.moreBtn&&(f+='<button class="js-htnpsne-awasete-btn-readmore" data-target-id="'+a+'"><i class="blogicon-list"></i></button>');"true"==b.dataset.subscribeBtn&&(f+='<button class="js-htnpsne-awasete-btn-subscribe" data-target-id="'+a+'"><i class="blogicon-subscribe"></i></button>');var c="";"Popular"==d?(c+='<option value="" data-command="Popular" selected>\u4eba\u6c17\u30a8\u30f3\u30c8\u30ea\u30fc</option>',d=""):c+='<option value="" data-command="Popular">\u4eba\u6c17\u30a8\u30f3\u30c8\u30ea\u30fc</option>';
"Recent"==d?(c+='<option value="" data-command="Recent" selected>\u65b0\u7740\u30a8\u30f3\u30c8\u30ea\u30fc</option>',d=""):c+='<option value="" data-command="Recent">\u65b0\u7740\u30a8\u30f3\u30c8\u30ea\u30fc</option>';for(var m=0;m<l.length;m++)c+='<option value="'+l[m]+'"',d==l[m]&&(c+=" selected"),c+=">"+v(decodeURIComponent(l[m]))+"</option>";k.innerHTML='<div class="js-htnpsne-awasete-control-outer"><span class="js-htnpsne-awasete-title">'+b.dataset.title+'</span><span class="js-htnpsne-awasete-control"><a href="http://psn.hatenablog.jp/entry/also-read" style="tipsy-top" id="Htn-psne-Awasete-Link-'+
a+'" original-title="\u3053\u306e\u6a5f\u80fd\u306f\u4f55\uff1f" target="_blank"><i class="blogicon-help"></i></a><select class="js-htnpsne-awasete-select" data-target-id="'+a+'">'+c+"</select>"+f+'</span></div><div class="js-htnpsne-awasete-entrys" data-target-id="'+a+'" data-count="'+~~b.dataset.count+'"'+e+h+g+"> :) </div>";b.appendChild(k)}function x(){for(var b=document.querySelectorAll(".js-htnpsne-awasete-select"),a=0;a<b.length;a++)"true"!=b[a].dataset.listen&&(b[a].dataset.listen="true",
b[a].addEventListener("change",function(){var a=this.dataset.targetId;if(""!=this.value)g(a,e+"/rss/category/"+this.value);else{var b=document.querySelectorAll('select[data-target-id="'+a+'"]')[0];"Popular"==b[b.selectedIndex].dataset.command?q(a,e):g(a,e+"/rss")}},!1));b=document.querySelectorAll(".js-htnpsne-awasete-btn-reload");for(a=0;a<b.length;a++)"true"!=b[a].dataset.listen&&(b[a].dataset.listen="true",b[a].addEventListener("click",function(){var a=this.dataset.targetId,b=document.querySelectorAll('select[data-target-id="'+
a+'"]')[0];""!=b.value?g(a,e+"/rss/category/"+document.querySelectorAll('select[data-target-id="'+a+'"]')[0].value):"Popular"==b[b.selectedIndex].dataset.command?q(a,e):g(a,e+"/rss")},!1));b=document.querySelectorAll(".js-htnpsne-awasete-btn-readmore");for(a=0;a<b.length;a++)"true"!=b[a].dataset.listen&&(b[a].dataset.listen="true",b[a].addEventListener("click",function(){var a=this.dataset.targetId,b=document.querySelectorAll('select[data-target-id="'+a+'"]')[0],g="",g=""!=b.value?e+"/archive/category/"+
document.querySelectorAll('select[data-target-id="'+a+'"]')[0].value:"Popular"==b[b.selectedIndex].dataset.command?"http://b.hatena.ne.jp/entrylist?sort=count&url="+encodeURIComponent(e):e+"/archive";window.open(g)},!1));b=document.querySelectorAll(".js-htnpsne-awasete-btn-subscribe");for(a=0;a<b.length;a++)"true"!=b[a].dataset.listen&&(b[a].dataset.listen="true",b[a].addEventListener("click",function(){var a=this.dataset.targetId,b=document.querySelectorAll('select[data-target-id="'+a+'"]')[0],g=
"",g=""!=b.value?e+"/rss/category/"+document.querySelectorAll('select[data-target-id="'+a+'"]')[0].value:"Popular"==b[b.selectedIndex].dataset.command?"http://b.hatena.ne.jp/entrylist?sort=count&mode=rss&url="+encodeURIComponent(e):e+"/feed",a="http://cloud.feedly.com/#subscription%2Ffeed%2F"+encodeURIComponent(g);window.open(a)},!1))}var e=document.getElementsByTagName("html")[0].dataset.blogsUriBase,w=document.getElementsByTagName("html")[0].dataset.blog,u=!0,l=[];"uninitialized"==document.readyState||
"loading"==document.readyState?window.addEventListener("DOMContentLoaded",function(){t()},!1):t()})();